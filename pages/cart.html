<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - ExoStore</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body style="background-color: #d9d2cd;">
    <header>
        <a href="../index.html">
            <img src="../assets/images/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo">
        </a>
        <a href="cart.html" class="cart-icon">
            <img src="../assets/images/cart-icon.png" alt="–ö–æ—Ä–∑–∏–Ω–∞">
            <span id="cart-count"></span>
        </a>
    </header>

    <div id="cart-message"></div>
    <div class="container scrollable" id="cart-items"></div>

    <button class="pay-btn" onclick="confirmClearCart()">üóë –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>

    <a href="javascript:history.back()" class="back-btn">‚¨Ö –ù–∞–∑–∞–¥</a>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const introVideoContainer = document.getElementById("intro-video-container");
            const introVideo = document.getElementById("intro-video");
            const content = document.getElementById("content");

            function showContent() {
                if (content) {
                    introVideoContainer.style.display = "none";
                    content.style.display = "block";
                }
            }

            if (sessionStorage.getItem("videoPlayed")) {
                showContent();
            } else {
                if (introVideo) {
                    content.style.display = "none";
                    introVideoContainer.style.display = "flex";

                    introVideo.addEventListener("ended", function () {
                        showContent();
                        sessionStorage.setItem("videoPlayed", "true");
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
                    setTimeout(showContent, 10000);
                } else {
                    showContent();
                }
            }

            if (window.location.pathname.includes("cart.html")) {
                loadCart();
            }
        });

        function updateCartCount() {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            let cartIcon = document.querySelector(".cart-icon span");
            if (cartIcon) {
                cartIcon.innerText = cart.length ? `(${cart.length})` : "";
            }
        }

        function loadCart() {
            console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã...");

            const cartContainer = document.getElementById("cart-items");
            if (!cartContainer) {
                console.warn("–≠–ª–µ–º–µ–Ω—Ç #cart-items –Ω–µ –Ω–∞–π–¥–µ–Ω! –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –µ—Å—Ç—å –≤ HTML.");
                return;
            }

            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            console.log("–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã –∏–∑ localStorage:", cart);

            if (cart.length === 0) {
                cartContainer.innerHTML = "<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
                return;
            }

            cartContainer.innerHTML = "";
            cart.forEach((item, index) => {
                const cartItem = document.createElement("div");
                cartItem.classList.add("cart-item");
                cartItem.innerHTML = `
                    <p>${item.title} - –†–∞–∑–º–µ—Ä: ${item.size}</p>
                <button class="remove-item" data-index="${index}" onclick="removeFromCart(${index})">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                `;
                cartContainer.appendChild(cartItem);
            });

            document.querySelectorAll(".remove-item").forEach(button => {
                button.onclick = function () {
                    let index = parseInt(this.getAttribute("data-index"), 10);
                    removeFromCart(index);
                };
            });
        }

        function removeFromCart(index) {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            if (index >= 0 && index < cart.length) {
                cart.splice(index, 1);
                localStorage.setItem("cart", JSON.stringify(cart));
            }

            setTimeout(() => {
                loadCart(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                updateCartCount(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
            }, 50);
        }

        function addToCart(button) {
            let productCard = button.closest(".product-card");
            let productTitle = productCard.querySelector(".product-title").innerText;
            let selectedSize = productCard.querySelector(".size-options button.selected");

            if (!selectedSize) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É!");
                return;
            }

            let size = selectedSize.innerText;
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            cart.push({ title: productTitle, size: size });
            localStorage.setItem("cart", JSON.stringify(cart));

            alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É: ${productTitle} (${size})`);
            updateCartCount();
        }
    </script>
</body>
</html>